<!DOCTYPE html>
<html>
<head>
<title>Contact Form</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="style.css">
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<!-- <script type="text/javascript" src="script.js"></script> -->
</head>
<body>

  <div class="wrapper">
    <h2>Contact form</h2>

    <form id="form" class="form" onsubmit="return validation()">
        <fieldset><legend>Contact form</legend>
          <p>
            <label for="fname">First name:</label><br>
            <input type="text" class="input_field"  id="fname" name="fname" size="30"><br>
          </p>
          <p>  
            <label for="lname">Last name:</label><br>
            <input type="text" class="input_field" id="lname" name="lname" size="30"><br>
          </p>
          <p>
            <label for="email">Email:</label><br>
            <input type="text" class="input_field" id="email" name="email" size="30"><br>
          </p>
          <p>
            <label for="gender">Gender:</label><br>
            <select name="gender"  id="gender">
              <option value="male">Male</option>
              <option value="female">Female</option>
            </select>
          </p>
          <p>
            <label for="country-select">Choose a country:</label>
            <select onchange="getCities(this.value)" name="countries"  id="country-select">
              <option value="">Choose a country:</option>
            </select>
          </p>
          <p>
            <label for="cities">Choose a city::</label>
            <select  name="cities"  id="cities" disabled>
              <option value="">Choose a city:</option>
            </select>
          </p>
          <p>
            <label for="phone">Phone:</label><br>
            <input type="text" id="phone"  name="phone" size="30" > <br>
          </p>
          <p>
            <label for="price">Price:</label><br>
            <input type="number" id="price"  name="price" size="30"><br>
          </p>
          <p>
            <label for="b_date">Date of Birth:</label><br>
            <input type="date" id="b_date"  name="b_date" size="30"><br>
          </p>
          <button id="submit" type="submit" class="btn" value="Submit">Submit</button>
          <div id="error-message"></div>
        </fieldset>  
      </form> 
  </div>
</body>

<script>
  


let countriesDropDown = document.querySelector("#country-select");

$.getJSON('https://api.npoint.io/66866aef2c21692fe055',function(data){

  let country;
  let id;

  let out = "";
  out += `<option value="">Choose a country:</option>`;

  $.each(data, function(i, name){
    country = name.country;
    id = name.id;
    out += `<option value="${id}">${country}</option>`
    
    console.log(`<option value="${id}">${country}</option>`);
  });

  countriesDropDown.innerHTML = out; 
});


function validation(){

let fname = document.getElementById("fname").value;
let lname = document.getElementById("lname").value;
let email = document.getElementById("email").value;
let phone = document.getElementById("phone").value;
let price = document.getElementById("price").value;
let error = document.getElementById("error-message");
console.log(error);
let text;

error.style.padding = "10px";
console.log(fname);
console.log(fname.length);
if(fname.length === 0){
text = "The first name is mandatory";
error.innerHTML = text;
return false;
}

if(lname.length === 0){
text = "The last name is mandatory";
error.innerHTML = text;
console.log(error);
return false;
}

let regex = /^\(?([0-9]{3})\)?[-]([0-9]{3})[-]([0-9]{4})$/;
if(!phone.match(regex)){
text = "Please Enter valid Phone Number";
error.innerHTML = text;
return false;
}

if(email.length === 0){
text = "The email is mandatory";
error.innerHTML = text;
return false;
}
else if(email.indexOf("@") == -1 || email.length < 6){
console.log("tuk sam");
text = "Please Enter valid Email";
error.innerHTML = text;
return false;
}

alert("Form Submitted Successfully!");
return true;

}  

function getCities(country){

let citiesDropDown = document.querySelector("#cities");

if(country.trim()===""){
citiesDropDown.disabled = true;
citiesDropDown.selectedIndex = 0;
return false;
}

$.getJSON('https://api.npoint.io/66866aef2c21692fe055',function(data){


let cities;
$.each(data, function(i, name){

  if(country == name.id){
  cities = name.cities;
  }

})

let out = "";
out += `<option value="">Choose a city:</option>`;
for(let city of cities){
out += `<option value="${city}">${city}</option>`
}



citiesDropDown.innerHTML = out;
citiesDropDown.disabled = false;

});
}


</script>

</html>